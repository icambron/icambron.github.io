/*
Timestack
http://icambron.github.com/timestack
Copyright 2012 Isaac Cambron
Released under the MIT license, license here: https://github.com/icambron/timestack/blob/master/Readme.markdown
*/
(function(){!function(t){var e;e=t,e.fn.extend({timestack:function(t){var n,a,r,s,i;if(a={click:function(){},parse:function(t){return moment(t)},renderDates:function(e){var n,a,r;return n=this.dateFormats[t.span],r=e.start.format(n),a=e.tilNow?"":e.end.format(n),this.formatRange(r,a)},formatRange:function(t,e){return t+" - "+e},span:"year",dateFormats:{year:"MMM YYYY",month:"MMM DD",day:"MMM DD",hour:"h:mm a"},intervalFormats:{year:"YYYY",month:"MMM YYYY",day:"MMM DD",hour:"h:mm a"}},t=e.extend(a,t),!(["year","month","day","hour"].indexOf(t.span)>-1))throw t.span+" is not a valid span option";return s=function(t){var n;return n=t.children("ul:not(.timestack-events)"),0===n.length?[]:[n,n.children("li").map(function(){var t;return t=e(this),{start:t.attr("data-start"),end:t.attr("data-end"),title:t.contents().filter(function(){return 3===this.nodeType}).remove().text(),color:t.attr("data-color"),li:t,content:t.children().remove()}})]},i=function(t,n){var a;return t.empty(),a=e("<ul></ul>"),t.append(a),[a,n]},r=function(e){var n,a,r,s,i;for(n=null,r=null,s=0,i=e.length;s<i;s++){if(a=e[s],a.start=t.parse(a.start),a.tilNow=null==a.end,a.end=a.tilNow?moment():t.parse(a.end),!(a.start<=a.end))throw"Start times must be before end times";n&&n<a.start||(n=a.start.clone()),r&&r>a.end||(r=a.end.clone())}return[n,r]},n=function(e,n){var a,r;for(r=[],a=e.clone().startOf(t.span);a<n;)r.push(a.clone()),a.add(t.span+"s",1);return r},this.each(function(){var a,o,l,d,c,u,f,m,p,h,v,M,k,y,Y,g,w,D,x,F,O,C,b,N;if(l=e(this),t.data?(C=i(l,t.data),d=C[0],v=C[1]):(b=s(l),d=b[0],v=b[1]),0!==v.length){if(!d)throw"Timestack requires either a data object or a UL for progressive enhancement.";for(d.css("width",t.width).addClass("timestack-events"),N=r(v),m=N[0],k=N[1],m.startOf(t.span),k.valueOf()!==k.clone().startOf(t.span).valueOf()&&k.endOf(t.span),f=k-m,D=0,F=v.length;D<F;D++)h=v[D],o=h.li,o||(o=e("<li></li>"),d.append(o)),h.timeDisplay=t.renderDates(h),Y=e("<em>("+h.timeDisplay+")</em>").addClass("timestack-time"),g=e("<span>"+h.title+" </span>").addClass("timestack-title"),M=e("<span></span>").addClass("timestack-label").append(g).append(Y),w=((h.end-h.start)/f*100-.01).toFixed(3),y=((h.start-m)/f*100-.01).toFixed(3),o.prepend(M).css("margin-left",y+"%").css("width",w+"%").click(function(e){return function(){return t.click(e)}}(h)),h.color&&o.css("background-color",h.color),t.click&&o.css("cursor","pointer"),null!=h["class"]&&o.addClass(h["class"]);for(u=n(m,k),w=(100/u.length-.01).toFixed(3)+"%",p=t.intervalFormats[t.span],a=e("<ul></ul>").addClass("intervals"),x=0,O=u.length;x<O;x++)c=u[x],e("<li></li>").text(c.format(p)).css("width",w).appendTo(a);return l.append(a)}})}})}(jQuery)}).call(this);